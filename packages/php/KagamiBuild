# Description: PHP interpreter
# URL:         https://www.php.net/
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  gmp acl db gdbm curl pcre2 libxslt apache sqlite libzip argon2 libffi icu heimdal libsodium oniguruma xz
# Section:     interpreters

name=php
version=7.4.8
release=1
backup=('etc/php/php.ini'
	'etc/php-fpm.conf'
	'etc/php-fpm.d/www.conf')
source=("http://www.php.net/distributions/$name-$version.tar.xz")

build() {
	cd "$SRC"/$name-$version
	./configure $BUILDFLAGS \
		--prefix=/usr \
		--sbindir=/usr/bin \
		--sysconfdir=/etc/php \
		--localstatedir=/var \
		--datadir=/usr/share/php \
		--mandir=/usr/share/man \
		--with-config-file-path=/etc/php \
		--with-config-file-scan-dir=/etc/php/conf.d \
		--with-layout=GNU \
		--with-bz2=shared \
		--with-curl=shared \
		--with-db4 \
		--with-external-pcre \
		--with-ffi \
		--with-gdb \
		--with-gmp \
		--with-kerberos \
		--with-openssl=shared \
		--with-password-argon2 \
		--with-pdo-sqlite \
		--with-pic \
		--with-readline \
		--with-sodium \
		--with-xml \
		--with-zlib \
		--without-iodbc \
		--without-pdo-odbc \
		--without-pear \
		--without-unixODBC \
		--enable-bcmath  \
		--enable-calendar \
		--enable-cli \
		--enable-ctype \
		--enable-dba=shared \
		--enable-dom \
		--enable-file-info \
		--enable-filter \
		--enable-fpm \
		--enable-ftp \
		--enable-ipv6 \
		--enable-mbstring \
		--enable-opcache \
		--enable-pdo \
		--enable-phar \
		--enable-posix \
		--enable-session \
		--enable-simplexml \
		--enable-sockets \
		--enable-sockets=shared \
		--enable-sysvmsg=shared \
		--enable-sysvsem=shared \
		--enable-sysvshm=shared \
		--enable-tokenizer \
		--enable-zip \
		--disable-cgi \
		--disable-debug \
		--disable-mbregex \
		--disable-rpath
	make
	make -j1 INSTALL_ROOT="$PKG" install

	rm "$PKG"/usr/lib/php/extensions/*.a
}
